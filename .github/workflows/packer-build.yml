name: Packer build AMI
on: 
  push:
    branches : [ main ]
jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x]

    steps:
      - run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} event."
      - name: Check out repository code
        uses: actions/checkout@v2
      - run: zip -r webservice.zip ./
          # Initialize Packer templates
      - name: Initialize Packer Template
        uses: hashicorp/packer-github-actions@master
        with:
          command: init
          target: ami.pkr.hcl
      - name: Build Artifact
        uses: hashicorp/packer-github-actions@master
        with:
           command: build
           arguments: "-var-file=dev-vars.pkrvars.json"
           target: ami.pkr.hcl